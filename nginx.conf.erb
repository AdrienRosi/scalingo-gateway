if ($http_apikey = "") {
  return 401;
}
if ($http_apikey != <%= ENV["API_KEY"] %>) {
  return 403;
}
location /api/v1 {
  add_header X-debug-message "api/v1" always;
  rewrite ^/api/v1(.*)$ / break;
  proxy_pass <%= ENV["API_V1_BACKEND"] %>;
}

location /api/v2 {
  add_header X-debug-message "api/v2" always;
  rewrite ^/api/v2(.*)$ / break;
  proxy_pass <%= ENV["API_V2_BACKEND"] %>;
}

add_header X-debug-message "No match" always;

return 503;
